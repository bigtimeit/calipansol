window.pwhDCFH=window.pwhDCFH||{},function(e){"use strict";var t=pwhDCFHPublic.i18n,a=".et_pb_contact_form",i='.et_pb_contact_submit:not(".et_pb_file_upload_button")',n=".et-pb-contact-message",l=e("."+pwhDCFHPublic.datepickerClass),d=e(".et_pb_contact_select2"),o="."+pwhDCFHPublic.uploadFileClass,s=(pwhDCFHPublic.wpLocale,pwhDCFHPublic.wpMaxUploadSize,pwhDCFHPublic.wpMaxUploadSizeFormatted,new Date),c={border:"1px solid red"};pwhDCFH.init=function(){e(a).length>0&&(pwhDCFHPublic.isSuperAdmin&&e(".et_pb_contact_form_container").length>0&&pwhDCFH.duplicateFormIDWarning(),e(".pwh-dcfh-textarea-validation").length>0&&pwhDCFH.textareaValidation(),e(o).length>0&&(pwhDCFH.uploadFiles(),pwhDCFH.removeFile(),"undefined"!=typeof et_link_options_data&&(et_link_options_data=[])),l.length>0&&pwhDCFH.addDateTimePicker(),d.length>0&&pwhDCFH.addSelect2(),pwhDCFH.setUniqueViewCookie(),pwhDCFH.redirectForm())},pwhDCFH.duplicateFormIDWarning=function(){let a=[];e(".et_pb_contact_form_container").each((function(t,i){let n=e(this).attr("id"),l=e(this).data("form_unique_id");a[l]?a[l].push(n):a[l]=[n]}));for(let i in a){let n=a[i];n.length>1&&e(n).each((function(a,i){e("#"+i).prepend("<div class='et_pb_duplicate_form_id_warning'>"+t.duplicate_form_id_text+"</div>")}))}},pwhDCFH.setUniqueViewCookie=function(){e(".et_pb_contact_form_container").each((function(t,a){let i=e(this).data("form_unique_id");if(void 0!==i){let e="pwh_dcfh_uniqueviews_"+pwhDCFHPublic.userIpAddress+"_"+i;pwhDCFH.setCookie(e,"pwh_dcfh_unique_views",364)}}))},pwhDCFH.addDateTimePicker=function(){l.each((function(t){let a=e(this).closest("form").parent().parent().attr("id"),i='input[name="'+e(this).attr("name")+'"]',n=e(i).data("locale"),l=e(i).data("type"),d=e(i).data("date"),o=e(i).data("time"),c=e(i).data("week-start"),r=e(i).data("inline"),p=e(i).data("setcurrent-datetime"),_=e(i).data("rtl"),f=e(i).data("disabled-week-days"),u=e(i).data("disabled-past-days"),m=e(i).data("disabled-current-date"),h=e(i).data("min-date-type"),b=e(i).data("min-date"),w=e(i).data("max-date-type"),v=e(i).data("max-date"),x=e(i).data("available-dates"),D=e(i).data("unavailable-dates"),C=e(i).data("min-time"),F=e(i).data("max-time"),g=e(i).data("available-times"),k=e(i).data("unavailable-times"),H=e(i).data("time-steps"),y=e(i).data("weeks"),P={inline:!1,step:H,closeOnDateSelect:!0,dayOfWeekStart:c,className:a,validateOnBlur:!1};if(P.format="date"===l?d:"time"===l?o:d+" "+o,""!==d?(P.datepicker=!0,P.formatDate=d):P.datepicker=!1,""!==o?(P.timepicker=!0,P.formatTime=o):P.timepicker=!1,void 0!==r&&"on"===r&&(P.inline=!0,P.lazyInit=!0,P.allowBlank=!0),void 0!==p&&"on"===p&&(P.value=s),void 0!==_&&"on"===_&&(P.rtl=!0),"off"===y&&(P.weeks=!0),""!==f&&("string"===jQuery.type(f)?(f=f.split(",").map((function(e){return parseInt(e)})),P.disabledWeekDays=f):P.disabledWeekDays=[f]),void 0!==u&&"on"===u&&(P.minDate=s),void 0!==m&&"on"===m&&(P.onSelectDate=function(t){e(".xdsoft_today").removeClass("xdsoft_current").addClass("xdsoft_disabled")},P.onGenerate=function(t){e(".xdsoft_today").removeClass("xdsoft_current").addClass("xdsoft_disabled")}),void 0!==h&&("fixed"===h&&(P.minDate=b),"relative"===h&&(P.minDate=b)),void 0!==w&&("fixed"===w&&(P.maxDate=v),"relative"===w&&(P.maxDate=v)),void 0!==x&&(P.startDate=x.split(",",1).toString(),P.allowDates=x),void 0!==D&&(P.disabledDates=D),void 0!==C&&(P.minTime=C),void 0!==F&&(P.maxTime=F),void 0!==g&&(P.allowTimes=g.split(",")),void 0!==k){let t=k.split(",");P.onGenerate=function(a){e(".xdsoft_time").each((function(a,i){-1!==e.inArray(e(i).text(),t)&&e(i).toggleClass("xdsoft_disabled")}))}}e(i).datetimepicker(P),e.datetimepicker.setLocale(n)}))},pwhDCFH.addSelect2=function(){d.select2(),e(document).on("select2:open",(t=>{const a=t.target.id;e(".select2-search__field[aria-controls='select2-"+a+"-results']").each((function(e,t){t.focus()}))}))};var r={},p=[];pwhDCFH.uploadFiles=function(){e(document).on("submit","form.et_pb_contact_form",(function(t){t.preventDefault(),e.each(e(this).find(".et_pb_contact_hidden_files"),(function(t,a){let i=e(this),n=i.data("field-id");i.hasClass("et_contact_error")?void 0!==i.data("required_mark")&&"required"===i.data("required_mark")&&e("p.et_pb_contact_field.et_pb_contact_field_"+n).css(c):i.attr("novalidate")||""!==i.val()||"undefined"===i.data("required_mark")||"required"!==i.data("required_mark")?e("p.et_pb_contact_field.et_pb_contact_field_"+n).css("border","none"):e("p.et_pb_contact_field.et_pb_contact_field_"+n).css(c)}))})),e("body").on("click",".et_pb_contact_submit.et_pb_button.et_pb_file_upload_button",(function(t){t.preventDefault(),e(o).trigger("click")})),e("body").on("change",o,(function(){let a=!1,l=e(this),d=l.closest("form"),o=d.find(i).text(),s=d.find(i).data("wait-text"),_=new FormData,f=l.data("field-id"),u=l.prop("files"),m=l.attr("name"),h=l.data("limit"),b=l.data("size"),w=l.data("size-formatted"),v=l[0].hasAttribute("multiple"),x="input:file[name="+m+"]",D="input:text[name="+m+"]",C="input:hidden[name="+m+"_file_token]",F=e("#et_pb_accepted_files_desc_"+f),g=d.parent().parent().find(n),k=e("p.et_pb_contact_field.et_pb_contact_field_"+f);r.hasOwnProperty(f)||(r[f]=[]);let H=g.has("ul").first().length,y="";v||1!==r[f].length||(y+="<li>"+t.x_files_allow_text.replace("{allowed_files}",1)+"</li>",a=!0),u.length+r[f].length>h&&(y+="<li>"+t.x_files_allow_text.replace("{allowed_files}",h)+"</li>",a=!0);for(let e=0;e<=u.length-1;e++)u[e].size>=b&&(y+="<li>"+t.allow_filesize_text.replace("{filename}",u[e].name).replace("{allowed_filesize}",w)+"</li>",a=!0);if(a&&(H>0?g.find("ul").first().append(y):g.append("<ul>"+y+"</ul>"),e(x).val(""),k.css(c)),!1===a){for(let e=0;e<=u.length-1;e++){if(p.includes(u[e].name))return y+="<li>"+t.already_attached_text.replace("{filename}",u[e].name)+"</li>",H>0?g.find("ul").first().append(y):g.append("<ul>"+y+"</ul>"),void k.css(c);_.append(e,u[e]),p.push(u[e].name)}_.append("action","upload_file"),_.append("_wpnonce",pwhDCFHPublic.ajaxNonce),_.append("token",e(C).val()),e.ajax({type:"post",dataType:"json",contentType:!1,processData:!1,url:pwhDCFHPublic.ajaxURL,data:_,xhr:function(){let e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){let a=Math.round(e.loaded/e.total*100);F.html(t.uploading_text.replace("{percentage}",a+"%"))}}),!1),e},beforeSend:function(){g.html(""),e("#et_pb_wait_spinner_"+f).addClass("is-active"),e(x).prop("disabled",!0),d.find(i).prop("disabled",!0),d.find(i).text(s)},success:function(t){if(!1!==t.success){if(t.data.success.length>0){let a="";e.each(t.data.success,(function(e,t){a+='<span class="et_pb_file" data-id="'+t.name+'">',a+='<a href="'+t.url+'" class="et_pb_file_name" download="">'+t.tmp_name+"</a>",a+='<span class="et_pb_file_size">('+t.size+")</span>",a+='<span class="et-pb-icon et_pb_delete_file" aria-hidden="true" title="Delete"  data-field-id="'+f+'" data-field-name="'+m+'" data-file-name="'+t.name+'"  data-file-tmp-name="'+t.tmp_name+'">&#x4d;</span>',a+="</span>",r.hasOwnProperty(f)||(r[f]=[]),r[f].push(t.name)})),e("#et_pb_files_list_"+f).append(a),e(D).val(r[f].join())}if(t.data.errors.length>0){let a="<ul>";e.each(t.data.errors,(function(e,t){a+="<li>"+t.message+"</li>"})),a+="</ul>",g.append(a),k.css(c)}}else g.append(t.data)},complete:function(){e(x).val(""),F.html(F.data("description")),e("#et_pb_wait_spinner_"+f).removeClass("is-active"),e(x).prop("disabled",!1),d.find(i).prop("disabled",!1),d.find(i).text(o);let a=e(D).val().split(",").length;a=1===a?t.selected_files_text.replace("{chosen_files_count}",a).replace("{s}",""):t.selected_files_text.replace("{chosen_files_count}",a).replace("{s}","s"),d.find(".et_pb_file_chosen_desc").text(a)},error:function(e,t,a){}})}}))},pwhDCFH.removeFile=function(){e("body").on("click",".et_pb_delete_file",(function(){let a=e(this),l=a.closest("form"),d=l.find(i).text(),o=l.find(i).data("wait-text"),s=a.data("file-tmp-name"),c=a.data("file-name");if(confirm(t.remove_file_text.replace("{filename}",s))){let _=e(n).parent().find(n),f=a.data("field-name"),u=a.data("field-id");if(""!==f&&""!==c){let a="input:text[name="+f+"]";e.ajax({type:"post",dataType:"json",url:pwhDCFHPublic.ajaxURL,data:{action:"remove_file",_wpnonce:pwhDCFHPublic.ajaxNonce,file_name:c},beforeSend:function(){e("#et_pb_wait_spinner_"+u).addClass("is-active"),l.find(i).prop("disabled",!0),l.find(i).text(o)},success:function(i){if(!0===i.success){e('span[data-id="'+c+'"]').remove();let i=e(a).val().split(",").filter((function(e){return e!==c}));r[u]=i,e(a).val(i.join(",")),p=p.filter((function(e){return e.replace(/\s+/g,"-")!==s}));let n=i.length;n=0===n?t.chosen_file_text:1===n?t.selected_files_text.replace("{chosen_files_count}",n).replace("{s}",""):t.selected_files_text.replace("{chosen_files_count}",n).replace("{s}","s"),l.find(".et_pb_file_chosen_desc").text(n)}else _.html("<p>"+i.data+"</p>")},complete:function(){e("#et_pb_wait_spinner_"+u).removeClass("is-active"),l.find(i).prop("disabled",!1),l.find(i).text(d)},error:function(e,t,a){}})}}}))},pwhDCFH.redirectForm=function(){e(document).on("submit","form"+a,(function(t){t.preventDefault();let a=e(this),i=setInterval((function(){if(!a.parent().parent().find(n).has("ul").first().length){clearInterval(i);let e=a.data("redirect-url"),t=a.data("redirect-delay");void 0!==e&&void 0!==t&&setTimeout((function(){location.href=e}),t)}}),1e3)}))},pwhDCFH.textareaValidation=function(){e(document).on("submit","form"+a,(function(t){t.stopPropagation();e(this);e(".pwh-dcfh-textarea-validation").each((function(t,a){let i=e(this),l=i.data("textarea"),d=i.data("title"),o=e("#"+l),s=o.data("pattern"),c=o.data("message"),r=new RegExp("^"+s+"$"),p=e(o.parents()[3]).find(n);p.has("ul").first().length;i.val(""),i.attr("data-required_mark","required");var _={};p.has("ul").find("li").each((function(t,a){let i=e(this).text().toLowerCase();_[i]?e(this).remove():_[i]=!0})),""!==document.all[l].value&&(e.trim(document.all[l].value).match(r)?(p.find('ul li:contains("'+d+'")').remove(),i.val(!0),i.removeAttr("data-required_mark")):p.find('ul li:contains("'+d+'")').html(c))}))}))},pwhDCFH.setCookie=function(e,t,a){var i="";if(a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3),i="; expires="+n.toUTCString()}document.cookie=e+"="+(t||"")+i+"; path=/"},e(pwhDCFH.init)}(jQuery);
