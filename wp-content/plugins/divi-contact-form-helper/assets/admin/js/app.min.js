window.pwhDCFH=window.pwhDCFH||{},function(t){"use strict";let e=t.now(),n=pwhDCFHAdmin.i18n;pwhDCFH.init=function(){t("#epanel-wrapper").length>0&&(pwhDCFH.generalSettings(),pwhDCFH.smtpGeneralSettings(),pwhDCFH.smtpEncryptionSettings(),pwhDCFH.smtpAuthSettings(),pwhDCFH.checkSMTPWorking()),t("#page-create-post").length>0&&(pwhDCFH.getPostTerms(),pwhDCFH.copyDataAs(),pwhDCFH.addFeaturedImage()),t("#page-create-email-template").length>0&&(pwhDCFH.getContactFormKeywords(),pwhDCFH.changeEmailType()),t("#page-send-email").length>0&&pwhDCFH.sendEmail(),t("#page-export-as-csv").length>0&&pwhDCFH.exportCSV()},pwhDCFH.generalSettings=function(){function e(){let e=t("#pwh_dcfh_backup_email").parents().eq(1),n=t("#pwh_dcfh_backup_schedule").parents().eq(1);return t("#pwh_dcfh_backup_enabled").is(":checked")?(t(e).show(),t(n).show(),!0):(t(e).hide(),t(n).hide(),!1)}t(e()),setTimeout((function(){let n=t(t("#pwh_dcfh_backup_enabled").parents().eq(1)).find(".et_pb_yes_no_button");t(n).on("click",(function(){setTimeout((function(){t(e())}),100)}))}),1e3)},pwhDCFH.smtpGeneralSettings=function(){function e(){let e=t("#pwh_dcfh_smtp_host").parents().eq(1),n=t("#pwh_dcfh_smtp_from_email").parents().eq(1),s=t("#pwh_dcfh_smtp_from_name").parents().eq(1),a=t("#pwh_dcfh_smtp_encryption").parents().eq(1),i=t("#pwh_dcfh_smtp_port").parents().eq(1),o=t("#pwh_dcfh_smtp_autotls").parents().eq(1),c=t("#pwh_dcfh_smtp_authentication").parents().eq(1),p=t("#pwh_dcfh_smtp_username").parents().eq(1),l=t("#pwh_dcfh_smtp_password").parents().eq(1),h=t("#pwh-dcfh-smtp-button").parents().eq(1);return t(p).hide(),t(l).hide(),t("#pwh_dcfh_smtp_enabled").is(":checked")?(t(e).show(),t(n).show(),t(s).show(),t(a).show(),t(i).show(),t(o).show(),t(c).show(),t("#pwh_dcfh_smtp_authentication").is(":checked")&&(t(p).show(),t(l).show()),t(h).show(),!0):(t(e).hide(),t(n).hide(),t(s).hide(),t(a).hide(),t(i).hide(),t(o).hide(),t(c).hide(),t(h).hide(),!1)}t(e()),setTimeout((function(){let n=t(t("#pwh_dcfh_smtp_enabled").parents().eq(1)).find(".et_pb_yes_no_button");t(n).on("click",(function(){setTimeout((function(){t(e())}),100)}))}),1e3)},pwhDCFH.smtpEncryptionSettings=function(){let e=t("#pwh_dcfh_smtp_encryption"),n=e.val();function s(e){let n=t("#pwh_dcfh_smtp_port"),s=n.val(),a=t("#pwh_dcfh_smtp_autotls").parents().eq(1);t(a).show(),"ssl"===e?n.val(465):"tls"===e?(n.val(587),t(a).hide()):""!==s?n.val(s):n.val(25)}t("#pwh_dcfh_smtp_enabled").is(":checked")&&s(n),setTimeout((function(){e.change((function(){let e=t(this).val();setTimeout((function(){s(e)}),100)}))}),1e3)},pwhDCFH.smtpAuthSettings=function(){function e(){let e=t("#pwh_dcfh_smtp_username").parents().eq(1),n=t("#pwh_dcfh_smtp_password").parents().eq(1);return t("#pwh_dcfh_smtp_enabled").is(":checked")&&t("#pwh_dcfh_smtp_authentication").is(":checked")?(t(e).show(),t(n).show(),!0):(t(e).hide(),t(n).hide(),!1)}t(e()),setTimeout((function(){let n=t(t("#pwh_dcfh_smtp_authentication").parents().eq(1)).find(".et_pb_yes_no_button");t(n).on("click",(function(){setTimeout((function(){t(e())}),100)}))}),1e3)},pwhDCFH.checkSMTPWorking=function(){t("#pwh-dcfh-smtp-button").click((function(e){e.preventDefault();let s=[];t("#pwh-dcfh-smtp-response").html("");let a=t('input[name="pwh_dcfh_smtp_host"]').val(),i=t('input[name="pwh_dcfh_smtp_from_name"]').val(),o=t('input[name="pwh_dcfh_smtp_from_email"]').val(),c=t('input[name="pwh_dcfh_smtp_port"]').val(),p=t('input[name="pwh_dcfh_smtp_username"]').val(),l=t('input[name="pwh_dcfh_smtp_password"]').val();if(""===a&&s.push(n.rSMTPHost),""===i&&s.push(n.rSMTPFromName),""===o&&s.push(n.rSMTPFromEmail),""===c&&s.push(n.rSMTPPort),t("#pwh_dcfh_smtp_enabled").is(":checked")&&t("#pwh_dcfh_smtp_authentication").is(":checked")&&(""===p&&s.push(n.rSMTPUsername),""===l&&s.push(n.rSMTPPassword)),s.length>0)return t("#pwh-dcfh-smtp-response").html(s.join("<br />")),!1;confirm(n.saveSMTPSettings)&&t.ajax({type:"post",dataType:"json",url:ajaxurl,data:{action:"process_smtp_test",_wpnonce:pwhDCFHAdmin.ajaxNonce},beforeSend:function(){t("#pwh-dcfh-smtp-response").html(n.pleaseWait)},success:function(e){t("#pwh-dcfh-smtp-response").html(e.data)},complete:function(t){},error:function(t,e,n){}})}))},pwhDCFH.getPostTerms=function(){t('select[name="to_post_type"]').change((function(){let e=t("#post_term"),s=t(".js-response"),a=t(this).val();""!==a&&t.ajax({type:"post",dataType:"json",url:ajaxurl,data:{action:"terms_list",_wpnonce:pwhDCFHAdmin.ajaxNonce,post_type:a},beforeSend:function(){t(".spinner").addClass("is-active")},success:function(t){!1!==t.success?(e.html('<option value="">'+n.selectTerm+"</option>"),e.append(t.data),e.removeAttr("disabled")):(e.html('<option value="">'+n.notApplicable+"</option>"),e.prop("disabled",!0))},complete:function(){t(".spinner").removeClass("is-active")},error:function(t,e,n){pwhDCFH.wpJsResponse(s,"<%= message %>",{message:t.responseJSON.data},"notice-error")}})}))},pwhDCFH.copyDataAs=function(){t(".copy-as").change((function(){let e=t(this).val(),s="#custom_field_"+t(this).data("row");"custom_field"===e?(t(s).prop("readonly",!1),t(s).prop("placeholder",n.customFieldName),t(s).autocomplete({source:function(e,n){let s=e.term;""!==s&&t.ajax({type:"post",dataType:"json",url:ajaxurl,data:{action:"meta_keys",_wpnonce:pwhDCFHAdmin.ajaxNonce,search_meta:s},success:function(e){n(t.map(e,(function(t){return t})))}})}})):(t(s).prop("readonly",!0),t(s).prop("placeholder",n.ChoosecustomFieldName))}))},pwhDCFH.addFeaturedImage=function(){t("#upload-featured-image").click((function(e){e.preventDefault();let n=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Use this image"},multiple:!1}).on("select",(function(){let e=n.state().get("selection").first().toJSON(),s=e.id,a=e.url;t("#uploaded-featured-image-id").val(s),t(".featured-img").css("display","block"),t("#uploaded-featured-image-url").attr("src",a)})).open()})),t("#js-remove-featured-image").click((function(e){e.preventDefault(),t("#uploaded-featured-image-id").val(""),t(".featured-img").css("display","none"),t("#uploaded-featured-image-url").attr("src","")}))},pwhDCFH.getContactFormKeywords=function(){let e='select[name="contact_form_id"]',n=t("#merge-data-tsgs-list"),s=t(e+" :selected").val(),a=JSON.parse(pwhDCFHAdmin.tplData);""!==s&&n.html(a[s].contact_form_fields_html),t(e).change((function(){let e=t(this).val();n.html(""),""!==e?n.html(a[e].contact_form_fields_html):(t("table tbody tr:first td:first span").html(""),n.html(""))})),t("body").on("click",".keyword",(function(){tinyMCE.activeEditor.insertContent(" "+t(this).text())}))},pwhDCFH.changeEmailType=function(){let e=t('select[name="tpl_type"]'),n=t('select[name="tpl_type"] :selected').val();-1!==t.inArray(n,["admin","confirmation"])&&(e.closest("table").find("tr.contact_form_id").hide(),e.closest("table").find("tr.email_from").hide(),e.closest("table").find("tr.email_subject").hide()),e.change((function(){let n=t(this).val();-1!==t.inArray(n,["admin","confirmation"])?(e.closest("table").find("tr.contact_form_id").hide(),e.closest("table").find("tr.email_from").hide(),e.closest("table").find("tr.email_subject").hide()):(e.closest("table").find("tr.contact_form_id").show(),e.closest("table").find("tr.email_from").show(),e.closest("table").find("tr.email_subject").show())}))},pwhDCFH.sendEmail=function(){let e=pwhDCFHAdmin.emailTemplates,n=JSON.parse(e);t('select[name="email_template"]').change((function(){t(".js-response");let e=t(this).val(),s=t("#email_from"),a=t("#email_subject"),i=t("#email_body");if(""!==e){t(".html-active").length;s.val(""),a.val(""),t(".html-active").length?i.val(""):tinyMCE.activeEditor.setContent("");let o=n[e],c=o.email_from,p=o.email_subject,l=o.email_body;""!==c&&""!==p&&""!==l?(s.val(c),a.val(p),t(".html-active").length?i.val(l):tinyMCE.activeEditor.setContent(l)):(s.val(""),a.val(""),t(".html-active").length?i.val(""):tinyMCE.activeEditor.setContent(""))}else s.val(""),a.val(""),t(".html-active").length?i.val(""):tinyMCE.activeEditor.setContent("")})),t("body").on("click",".keyword",(function(){tinyMCE.activeEditor.insertContent(" "+t(this).text())}))},pwhDCFH.exportCSV=function(){let n='select[name="contact_form_id"]',s=t(".merge-data-tsgs-list"),a=t(n+" :selected").val(),i=JSON.parse(pwhDCFHAdmin.csvData);e="-"+e,""!==a&&(t("table tr").eq(0).show(),t("table tbody tr:first td:first span").html(i[a].contact_form_total_entries),t("input:text[name='file_name']").val(i[a].contact_form_title+e),t("table tr").eq(3).show(),s.html(i[a].contact_form_fields_html)),t(n).change((function(){let n=t(this).val();s.html(""),""!==n?(t("table tr").eq(0).show(),t("table tbody tr:first td:first span").html(i[n].contact_form_total_entries),t("input:text[name='file_name']").val(i[n].contact_form_title+e),t("table tr").eq(3).show(),s.html(i[n].contact_form_fields_html)):(t("table tr").eq(0).hide(),t("table tbody tr:first td:first span").html(""),t("input:text[name='file_name']").val("divi-contact-form-entries"+e),t("table tr").eq(3).hide(),s.html(""))}))},pwhDCFH.wpJsResponse=function(e,n,s,a){let i={attrClass:a=void 0===a?"notice is-dismissible":"notice is-dismissible "+a,html:_.template(n)(s)},o=_.template('<div class="<%= attrClass %>"><p><%= html %></p><button type="button" class="notice-dismiss"></button></div>')(i),c=t(o);return c.on("click.wp-dismiss-notice",".notice-dismiss",(function(e){e.preventDefault(),c.fadeTo(100,0,(function(){t(this).slideUp(100,(function(){t(this).remove()}))}))})),e.append(c)},t(pwhDCFH.init)}(jQuery);
